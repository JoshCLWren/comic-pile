{% if snapshots %}
<div class="space-y-2">
    <div class="flex items-center justify-between px-3 py-2 mb-3 bg-teal-500/5 border border-teal-500/10 rounded-lg">
        <div class="flex items-center gap-2">
            <span class="text-xs">üõ°Ô∏è</span>
            <span class="text-[10px] font-bold text-teal-400 uppercase tracking-wider">
                {{ snapshots|length }} Restore Points Available
            </span>
        </div>
    </div>
    <div id="undo-success-message" class="hidden mb-3 p-3 bg-teal-500/10 border border-teal-500/20 rounded-lg">
        <p class="text-xs font-black text-teal-400 text-center uppercase tracking-wider">
            ‚úì Successfully restored
        </p>
    </div>
    {% for snapshot in snapshots %}
    <div class="flex items-center justify-between px-4 py-3 bg-white/5 rounded-xl border border-white/5 group transition-all hover:bg-white/10 hover:border-white/10 cursor-pointer {% if snapshot.description == 'Session start' %}bg-indigo-500/5 border-indigo-500/20{% endif %}">
        <div class="flex-1 min-w-0 pr-3">
            <div class="flex items-center gap-2 mb-1">
                {% if snapshot.description == 'Session start' %}
                <span class="text-[9px] font-black uppercase tracking-widest text-indigo-400">
                    Session Start
                </span>
                {% else %}
                <span class="text-[9px] font-black uppercase tracking-widest text-teal-400">
                    {{ snapshot.created_at.strftime('%b %d, %I:%M %p') }}
                </span>
                {% endif %}
            </div>
            <p class="text-[10px] font-bold text-slate-300 break-words leading-snug">
                {{ snapshot.description }}
            </p>
        </div>
        {% if snapshot.description == 'Session start' %}
        <button
            onclick="restoreSessionStart({{ session_id }})"
            class="h-8 px-3 glass-button text-[10px] font-black uppercase tracking-widest whitespace-nowrap bg-indigo-500/10 border-indigo-500/20 hover:bg-indigo-500/20 hover:border-indigo-500/30 transition-all">
            <span class="htmx-indicator flex items-center justify-center">
                <span class="spinner"></span>
            </span>
            <span class="htmx-request:hidden">Restore Start</span>
        </button>
        {% else %}
        <button
            onclick="undoToSnapshot({{ session_id }}, {{ snapshot.id }})"
            class="h-8 px-3 glass-button text-[10px] font-black uppercase tracking-widest whitespace-nowrap bg-teal-500/10 border-teal-500/20 hover:bg-teal-500/20 hover:border-teal-500/30 transition-all">
            <span class="htmx-indicator flex items-center justify-center">
                <span class="spinner"></span>
            </span>
            <span class="htmx-request:hidden">Restore</span>
        </button>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<p class="text-[10px] text-slate-500 text-center py-4">No snapshots available for this session</p>
<div class="px-3 py-2 bg-rose-500/5 border border-rose-500/10 rounded-lg">
    <p class="text-[10px] font-black text-rose-300 text-center uppercase tracking-wider">
        ‚ö†Ô∏è No restore points available
    </p>
</div>
{% endif %}

<script>
    function undoToSnapshot(sessionId, snapshotId) {
        const btn = event.target.closest('button');
        btn.classList.add('opacity-50', 'pointer-events-none');

        fetch(`/undo/${sessionId}/undo/${snapshotId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
            if (response.ok) {
                const undoContainer = document.getElementById('undo-success-message');
                if (undoContainer) {
                    undoContainer.classList.remove('hidden');
                    undoContainer.classList.add('animate-pulse');
                    setTimeout(() => {
                        undoContainer.classList.add('hidden');
                        undoContainer.classList.remove('animate-pulse');
                        location.reload();
                    }, 1500);
                }
            } else {
                throw new Error('Undo failed');
            }
        })
        .catch(error => {
            console.error('Undo failed:', error);
            alert('Failed to undo. Please try again.');
            btn.classList.remove('opacity-50', 'pointer-events-none');
        });
    }

    function restoreSessionStart(sessionId) {
        const btn = event.target.closest('button');
        btn.classList.add('opacity-50', 'pointer-events-none');

        fetch(`/sessions/${sessionId}/restore-session-start`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
            if (response.ok) {
                const undoContainer = document.getElementById('undo-success-message');
                if (undoContainer) {
                    undoContainer.classList.remove('hidden');
                    undoContainer.classList.add('animate-pulse');
                    setTimeout(() => {
                        undoContainer.classList.add('hidden');
                        undoContainer.classList.remove('animate-pulse');
                        location.reload();
                    }, 1500);
                }
            } else {
                throw new Error('Restore failed');
            }
        })
        .catch(error => {
            console.error('Restore failed:', error);
            alert('Failed to restore session. Please try again.');
            btn.classList.remove('opacity-50', 'pointer-events-none');
        });
    }
</script>
