{% extends "base.html" %}

{% block content %}
<div class="space-y-8 pb-10">
    <header class="px-2">
        <h1 class="text-4xl font-black tracking-tighter text-glow mb-1 uppercase">Settings</h1>
        <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Configure your experience</p>
    </header>

    <div id="settings-container" class="space-y-4">
        <div id="settings-form-container"
            class="glass-card p-6"
            hx-get="/admin/settings"
            hx-trigger="load"
            hx-swap="innerHTML"
            hx-target="#settings-form">
            <div class="flex items-center justify-center h-40">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-teal-500"></div>
            </div>
        </div>
        <div id="settings-form"></div>
    </div>

    <div id="save-message" class="hidden glass-card p-4 border-teal-500/20 bg-teal-500/10">
        <p class="text-center text-teal-400 font-bold text-sm uppercase tracking-widest">Settings saved!</p>
    </div>
</div>

<script>
    function showSaveMessage() {
        const msg = document.getElementById('save-message');
        msg.classList.remove('hidden');
        setTimeout(() => msg.classList.add('hidden'), 2000);
    }

    function validateSettingsForm() {
        const form = document.getElementById('settings-update-form');
        if (!form) return false;

        const startDie = parseInt(form.elements['start_die'].value);
        const sessionGap = parseInt(form.elements['session_gap_hours'].value);
        const ratingMin = parseFloat(form.elements['rating_min'].value);
        const ratingMax = parseFloat(form.elements['rating_max'].value);
        const ratingStep = parseFloat(form.elements['rating_step'].value);
        const ratingThreshold = parseFloat(form.elements['rating_threshold'].value);

        const dieOptions = [4, 6, 8, 10, 12, 20];
        if (!dieOptions.includes(startDie)) {
            alert('Start die must be one of: d4, d6, d8, d10, d12, d20');
            return false;
        }

        if (sessionGap < 1 || sessionGap > 168) {
            alert('Session gap must be between 1 and 168 hours');
            return false;
        }

        if (ratingMin >= ratingMax) {
            alert('Rating minimum must be less than maximum');
            return false;
        }

        if (ratingStep <= 0) {
            alert('Rating step must be positive');
            return false;
        }

        return true;
    }
</script>
{% endblock %}
