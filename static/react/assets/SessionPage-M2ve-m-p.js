import{u as p,d as m,e as h,j as e}from"./index-BL2gXtyb.js";import{b as u,c as j,d as b}from"./useSession-Bmm1INxa.js";import{u as N}from"./useMutation-W0ek29RX.js";import{b as i}from"./dateFormat-Ck_uZvap.js";import{L as g}from"./LoadingSpinner-Du9d51Du.js";import"./useQuery-Hz1vUfiu.js";function f(){const a=p();return N({mutationFn:({sessionId:t,snapshotId:l})=>m.undo(t,l),onSuccess:()=>{a.invalidateQueries({queryKey:["session"]}),a.invalidateQueries({queryKey:["threads"]}),a.invalidateQueries({queryKey:["sessions"]})},onError:t=>{console.error("Failed to undo action:",t.response?.data?.detail||t.message)}})}function q(){const{id:a}=h(),{data:t,isLoading:l}=u(a),{data:o}=j(a),d=b(),n=f(),r=o?.snapshots??[];return l?e.jsx(g,{fullScreen:!0}):t?e.jsxs("div",{className:"space-y-8 pb-20",children:[e.jsxs("header",{className:"px-2",children:[e.jsx("h1",{className:"text-4xl font-black tracking-tighter text-glow mb-1 uppercase",children:"Session Details"}),e.jsxs("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:["Session #",t.session_id]})]}),e.jsxs("div",{className:"glass-card p-6 space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Started"}),e.jsx("p",{className:"text-sm font-black text-slate-100",children:i(t.started_at)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Ended"}),e.jsx("p",{className:"text-sm font-black text-slate-100",children:t.ended_at?i(t.ended_at):"Active"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Start Die"}),e.jsxs("p",{className:"text-sm font-black text-slate-100",children:["d",t.start_die]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Current Die"}),e.jsxs("p",{className:"text-sm font-black text-slate-100",children:["d",t.current_die]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:"Ladder Path"}),e.jsx("p",{className:"text-sm font-bold text-slate-300",children:t.ladder_path})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:Object.entries(t.narrative_summary||{}).map(([s,c])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:s}),c&&c.length>0?e.jsx("ul",{className:"space-y-1 text-xs text-slate-300",children:c.map(x=>e.jsx("li",{children:x},x))}):e.jsx("p",{className:"text-xs text-slate-600",children:"None"})]},s))})]}),e.jsxs("div",{className:"glass-card p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-black uppercase text-slate-100",children:"Snapshots"}),e.jsx("button",{type:"button",onClick:()=>d.mutate(t.session_id),disabled:d.isPending||r.length===0,className:"h-10 px-4 bg-white/5 border border-white/10 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-300 hover:bg-white/10 disabled:opacity-60",children:d.isPending?"Restoring...":"Restore Start"})]}),r.length===0?e.jsx("p",{className:"text-xs text-slate-500",children:"No snapshots available."}):e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-4 bg-white/5 border border-white/10 rounded-xl px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-200",children:s.description||"Snapshot"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:i(s.created_at)})]}),e.jsx("button",{type:"button",onClick:()=>n.mutate({sessionId:t.session_id,snapshotId:s.id}),disabled:n.isPending,className:"h-10 px-4 bg-white/5 border border-white/10 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-300 hover:bg-white/10 disabled:opacity-60",children:"Undo"})]},s.id))})]}),e.jsxs("div",{className:"glass-card p-6 space-y-4",children:[e.jsx("h2",{className:"text-lg font-black uppercase text-slate-100",children:"Event Timeline"}),t.events.length===0?e.jsx("p",{className:"text-xs text-slate-500",children:"No events recorded."}):e.jsx("div",{className:"space-y-3",children:t.events.map(s=>e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-500",children:i(s.timestamp)}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-teal-400",children:s.type})]}),e.jsxs("p",{className:"text-sm text-slate-200",children:[s.thread_title||"Thread",s.rating?` • Rated ${s.rating}`:"",s.result?` • Rolled ${s.result}`:"",s.die?` • d${s.die}`:""]}),s.queue_move&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Queue move: ",s.queue_move]})]},s.id))})]})]}):e.jsx("div",{className:"text-center text-slate-500",children:"Session not found"})}export{q as default};
