import{u as M,b as E,a as o,j as e,c as q,s as F}from"./index-__WT2_qJ.js";import{u as I}from"./useQuery-DX3QrD2J.js";import{u as $}from"./useMutation-DM5q4cKt.js";import{L as j,D as n}from"./diceLadder-CtY544zQ.js";import{T as L}from"./Tooltip-DECGo7Cu.js";function O(){const p=M(),m=E(),[r,N]=o.useState(4),[d,h]=o.useState(6),[c,w]=o.useState(6),[k,f]=o.useState(6),[S,_]=o.useState(1),[g,P]=o.useState(""),{data:a}=I({queryKey:["session","current"],queryFn:F.getCurrent}),x=$({mutationFn:q.rate,onSuccess:()=>{p.invalidateQueries({queryKey:["session"]}),p.invalidateQueries({queryKey:["threads"]}),m("/")},onError:t=>{P(t.response?.data?.detail||"Failed to save rating")}});o.useEffect(()=>{if(a){const t=a.current_die||6,l=a.last_rolled_result||1;w(t),h(t),f(t),_(l)}},[a]);function R(t){const l=parseFloat(t);N(l);let i=c;if(l>=4){const s=n.indexOf(c);s>0?i=n[s-1]:i=n[0]}else{const s=n.indexOf(c);s<n.length-1?i=n[s+1]:i=n[n.length-1]}h(i),f(i)}function D(){const t=document.getElementById("explosion-layer");if(!t)return;const l=50;for(let i=0;i<l;i++){const s=document.createElement("div");s.className="particle";const v=Math.random()*Math.PI*2,y=150+Math.random()*250;s.style.left="50%",s.style.top="50%",s.style.setProperty("--tx",Math.cos(v)*y+"px"),s.style.setProperty("--ty",Math.sin(v)*y+"px"),s.style.background=i%2?"var(--accent-teal)":"var(--accent-violet)",t.appendChild(s),setTimeout(()=>s.remove(),1e3)}}function C(){return!a||!a.has_restore_point?window.confirm(`âš ï¸ No restore point available!

You are about to make a destructive action that cannot be undone. Continue anyway?`):!0}function b(t=!1){C()&&(r>=4&&D(),x.mutate({rating:r,issues_read:1,finish_session:t}))}if(!a||!a.active_thread)return e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“"}),e.jsx("h2",{className:"text-xl font-black text-slate-300 uppercase tracking-wider mb-2",children:"Session Inactive"}),e.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"Roll the dice to start a reading session"}),e.jsx("button",{onClick:()=>m("/"),className:"px-6 py-3 bg-teal-500/20 hover:bg-teal-500/30 border border-teal-500/30 rounded-xl text-sm font-bold uppercase tracking-widest text-teal-400 transition-colors",children:"Go to Roll Page"})]});const u=a.active_thread;return e.jsxs("div",{className:"space-y-8 pb-10",children:[e.jsxs("header",{className:"flex justify-between items-center px-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black tracking-tighter text-glow mb-1 uppercase",children:"Rate Session"}),e.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Mark your progress"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a.has_restore_point&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-teal-500/10 border border-teal-500/20 rounded-lg",children:[e.jsx("span",{className:"text-xs",children:"ðŸ›¡ï¸"}),e.jsx("span",{className:"text-[9px] font-black text-teal-400 uppercase",children:"Session Safe"})]}),e.jsx("div",{className:"dice-perspective relative",style:{width:"50px",height:"50px",transform:"scale(0.4)"},children:e.jsx(j,{sides:c,value:1,isRolling:!1,showValue:!1,color:16777215})})]})]}),e.jsxs("div",{className:"glass-card p-10 space-y-12 relative overflow-hidden max-w-3xl mx-auto",children:[e.jsx("div",{id:"glow-bg",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-teal-600/10 rounded-full blur-[100px] transition-colors duration-500"}),e.jsx("div",{id:"thread-info",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("h2",{className:"text-3xl font-black text-slate-100",children:u.title}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:"bg-indigo-500/20 text-indigo-300 px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-[0.2em] border border-indigo-500/20",children:u.format}),e.jsxs("span",{className:"text-slate-500 text-xs font-bold",children:[u.issues_remaining," Issues left"]})]})]})}),e.jsxs("div",{className:"space-y-12 relative z-10",children:[e.jsx("div",{id:"rating-preview-dice",className:"dice-perspective mb-4",children:e.jsxs("div",{id:"die-preview-wrapper",className:"dice-state-rate-flow relative flex items-center justify-center",style:{width:"120px",height:"120px",margin:"0 auto"},children:[e.jsx(j,{sides:k,value:S,isRolling:!1,showValue:!1,freeze:!0,color:16777215}),e.jsx("span",{className:"absolute -bottom-5 left-1/2 -translate-x-1/2 text-[8px] font-bold uppercase tracking-wider text-indigo-400",children:"Rating"})]})}),e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx(L,{content:"Ratings of 4.0+ move the thread to the front and step the die down. Lower ratings move it back and step the die up.",children:e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-slate-500 cursor-help",children:"How was it?"})}),e.jsx("div",{id:"rating-value",className:r>=4?"text-teal-400":"text-indigo-400",children:r.toFixed(1)}),e.jsx("input",{type:"range",id:"rating-input",name:"rating",min:"0.5",max:"5.0",step:"0.5",value:r,className:"w-full h-4",onChange:t=>R(t.target.value)})]}),e.jsx("div",{className:`p-6 rounded-3xl border shadow-xl ${r>=4?"bg-teal-500/5 border-teal-500/20":"bg-indigo-500/5 border-indigo-500/20"}`,children:e.jsx("p",{id:"queue-effect",className:"text-xs font-black text-slate-200 text-center uppercase tracking-[0.15em] leading-relaxed",children:r>=4?`Excellent! Die steps down ðŸŽ² Move to front${d!==c?` (d${d})`:""}`:`Okay. Die steps up ðŸŽ² Move to back${d!==c?` (d${d})`:""}`})}),e.jsx("button",{type:"button",id:"submit-btn",onClick:()=>b(!1),disabled:x.isPending,className:"w-full py-6 glass-button text-xl font-black uppercase tracking-[0.2em] relative shadow-[0_15px_40px_rgba(20,184,166,0.3)] disabled:opacity-50",children:x.isPending?e.jsx("span",{className:"spinner mx-auto"}):"Save & Continue"}),e.jsx("button",{type:"button",id:"finish-btn",onClick:()=>b(!0),disabled:x.isPending,className:"w-full py-4 text-lg font-black uppercase tracking-[0.2em] text-slate-400 hover:text-slate-300 transition-colors disabled:opacity-50",children:"Finish Session"}),e.jsx("div",{id:"error-message",className:`text-xs text-rose-500 text-center font-bold ${g?"":"hidden"}`,children:g})]})]})]})}export{O as default};
