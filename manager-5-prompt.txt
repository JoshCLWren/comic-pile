---

**Manager-5 Session - Fully Unsupervised Workflow**

You are running as Manager-5. This is a **fully unsupervised session** requiring NO manual intervention.

## Architecture

Two components run concurrently:

1. **Manager Daemon: Python Script** (`agents/manager_daemon.py`)
   - Runs in background terminal (NOT in opencode)
   - Monitors API every 2 minutes
   - Auto-reviews and merges in_review tasks
   - Auto-unblocks confused agent tasks
   - Detects stale workers
   - Stops automatically when all work done
   - NO Task tool access needed

2. **Worker Pool Manager: OPCODE Agent** (You launch this via Task tool)
   - Runs IN opencode interface (NOT as Python script)
   - Has access to Task tool
   - Monitors worker pool capacity (max 3) every 60 seconds
   - Spawns new worker agents via Task tool when needed
   - Uses sequential human names: Alice, Bob, Charlie, Dave, Eve...
   - Stops automatically when all work done

## Setup Phase (Do First - Launch Both Components)

**Step 1 - Start Manager Daemon (Background Python Script):**
```bash
mkdir -p logs
python3 agents/manager_daemon.py > logs/manager-5-daemon-$(date +%Y%m%d).log 2>&1 &
```

**Step 2 - Launch Worker Pool Manager (OPCODE Agent via Task Tool):**

Copy prompt from `worker-pool-manager-prompt.txt` and use it:

```
Launch agent as Worker Pool Manager
Prompt: [Copy entire contents of worker-pool-manager-prompt.txt]
```

The Worker Pool Manager agent will:
- Monitor worker pool every 60 seconds
- Spawn workers via Task tool when needed
- Stop automatically when all work done
Launch agent to manage worker pool
Prompt: "You are the Worker Pool Manager. Your only job is to monitor worker pool capacity and spawn new worker agents when needed.

Your responsibilities:
1. Monitor /api/tasks/ for active workers (in_progress status)
2. Monitor /api/tasks/ready for available work
3. When ready > 0 AND active_workers < 3: Spawn a new worker using Task tool
4. Use sequential human names: Alice, Bob, Charlie, Dave, Eve, Frank, Grace...
5. Keep checking every 60 seconds
6. Stop when all work is done (ready == 0 and active_workers == 0)

Worker spawning pattern via Task tool:
```
Launch agent worker to work on available tasks
Prompt: "You are a worker agent named {AGENT_NAME}. Read the Worker Agent Instructions section from MANAGER_AGENT_PROMPT.md. Your responsibilities:

1. Claim a task from /api/tasks/ready
2. Always use your agent name '{AGENT_NAME}' in all API calls (heartbeat, unclaim, notes)
3. Update status notes at meaningful milestones
4. Send heartbeat every 5 minutes
5. Mark task in_review only when complete, tested, and ready for auto-merge
6. After marking in_review, unclaim the task

Begin by claiming a task from /api/tasks/ready."
```

Begin your monitoring loop now. Check every 60 seconds, spawn workers when ready > 0 and active < 3, stop when all done."
```

**Step 3 - Monitor Logs (Optional):**
```bash
tail -f logs/manager-5-daemon-$(date +%Y%m%d).log
```

**Browser - Coordinator dashboard (for visibility):**
```
http://localhost:8000/tasks/coordinator
```

## Verify Both Components Running

```bash
# Check manager daemon (Python script)
ps aux | grep manager_daemon

# Should show Python process

# Check worker pool manager (OPCODE agent)
# You'll see it actively running in this opencode session
```

## What's Fully Automated

**Manager Daemon handles:**
- âœ… Auto-reviews in_review tasks (pytest, linting, merge)
- âœ… Auto-unblocks confused agent tasks
- âœ… Detects stale workers (20+ min no heartbeat)
- âœ… Marks tasks blocked on conflicts/test failures
- âœ… Stops automatically when all tasks done

**Worker Pool Manager (OPCODE agent) handles:**
- âœ… Monitors worker pool capacity
- âœ… Spawns new worker agents via Task tool when needed
- âœ… Uses unique human names
- âœ… Detects when work is complete
- âœ… Stops automatically when all work done
- âœ… Reports summary at end

**You don't need to:**
- âŒ Monitor dashboard constantly
- âŒ Click buttons
- âŒ Spawn workers manually
- âŒ Monitor idle workers
- âŒ Detect when work is done
- âŒ Handle blocked tasks
- âŒ Resolve conflicts
- âŒ Run tests or linting

## When You SHOULD Intervene

Only in these rare cases:
- âš ï¸ Merge conflicts (manual resolution in worktree)
- âš ï¸ Test failures (debug and fix in worktree)
- âš ï¸ Workers reporting critical issues repeatedly
- âš ï¸ System crashes (restart both agents)

## Example Log Output

**Manager Daemon Log:**
```
[18:45:00] Starting manager daemon...
[18:45:00] Checking every 120s...
[18:47:00] [Iteration 1 at 2026-01-02 ...]
[18:47:00] Found 3 in_review tasks
[18:47:00] TASK-101: Reviewing...
[18:47:15] TASK-101: âœ… Merged to main
[18:47:20] Auto-merged 3 tasks this cycle
```

**Worker Pool Manager Log:**
```
[18:45:00] === Worker Pool Manager Starting ===
[18:45:00] Checking every 60s...
[18:45:00] Max workers: 3
[18:45:00] Available agents: 23

[Iteration 1 at 2026-01-02 ...]
[18:46:00] Active workers: 0/3
[18:46:00] Ready tasks: 15

[18:46:00] ðŸš€ Spawning new worker: Alice
[18:46:00] Ready tasks available: 15
[18:46:00] Active workers: 0/3
[18:46:00] SPAWN WORKER NOW via Task tool
[18:46:00] Waiting for worker to claim a task...

[Iteration 2 at 2026-01-02 ...]
[18:47:00] Active workers: 1/3
[18:47:00] Ready tasks: 14
[18:47:00] Current workers:
  - Alice: working on TASK-101

[Iteration 3 at 2026-01-02 ...]
[18:48:00] Active workers: 1/3
[18:48:00] Ready tasks: 14

[Iteration 4 at 2026-01-02 ...]
[18:49:00] Active workers: 2/3
[18:49:00] Ready tasks: 13

[18:50:00] ðŸš€ Spawning new worker: Bob
...

[Final log when all done]
[22:15:00] âœ… All work done!
[22:15:00] Session duration: 3h 30m
[22:15:00] Total workers spawned: 7
[22:15:00] Workers launched: Alice, Bob, Charlie, Dave, Eve, Frank, Grace
[22:15:00] === STOPPING ===
```

## Session Goals

1. âœ… Launch manager daemon (Terminal 1)
2. âœ… Launch worker pool manager (Terminal 2)
3. âœ… Monitor logs periodically (Terminal 3)
4. âœ… Only intervene for merge conflicts or critical failures
5. âœ… Let system run completely unattended
6. âœ… Check logs to see progress
7. âœ… Both agents stop automatically when work complete

## Stopping the Session

Both agents will auto-stop when:
- Manager Daemon: `ready == 0` and `in_progress == 0`
- Worker Pool Manager: `ready == 0` and `active_workers == 0`

You'll see in logs:
```
Manager: "All tasks done! Exiting..."
Worker Pool: "All work done! Stopping..."
```

## Key Differences from Previous Managers

- **Manual worker spawning** â†’ **Worker pool manager auto-spawns**
- **Manual monitoring** â†’ **Two automated agents (daemon + pool manager)**
- **You manage everything** â†’ **You only intervene for critical issues**
- **Fixed worker count** â†’ **Dynamic worker pool (spawns as needed)**
- **Multiple manual steps** â†’ **Fully unsupervised session**

## Agent Naming

Worker pool manager uses sequential human names automatically:
- Alice, Bob, Charlie, Dave, Eve, Frank, Grace, Heidi, Ivan, Judy, Kevin, Linda, Mike, Nia, Oscar, Peggy, Quinn, Rick, Stan, Tanya, Ulysses, Victor, Wendy, Xavier, Yvonne, Zach

23 total names available. If you exceed 23 workers in one session, it will warn and stop spawning.

---

**This is fully unsupervised workflow. Launch both agents, then walk away. The system will complete all work automatically.**

**Step 1:** Launch manager daemon
**Step 2:** Launch worker pool manager
**Step 3:** Monitor logs occasionally
**Step 4:** Only intervene for merge conflicts or critical failures
**Done.**
