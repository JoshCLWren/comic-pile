name: 'Setup Environment'
description: 'Install system dependencies, set up uv, Python 3.13, and sync project dependencies'

runs:
  using: 'composite'
  steps:
    - name: Install system dependencies
      shell: bash
      run: |
        apt-get update -qq
        apt-get install -y -qq ca-certificates curl git python3 python3-venv nodejs npm gpg
        apt-get install -y -qq libnss3 libnspr4 libatk1.0-0 libatk-bridge2.0-0 libcups2 libdrm2 libxkbcommon0 libxcomposite1 libxdamage1 libxfixes3 libxrandr2 libgbm1 libasound2

    - name: Set up uv
      uses: astral-sh/setup-uv@v5

    - name: Install Python 3.13 and create venv
      shell: bash
      run: uv python install 3.13 && uv venv

    - name: Sync dependencies
      shell: bash
      run: source .venv/bin/activate && uv sync --all-extras

    - name: Install Node.js dependencies
      shell: bash
      run: |
        npm ci
        if [ -d frontend ]; then
          (cd frontend && npm ci)
        fi
